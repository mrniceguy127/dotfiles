#!/bin/bash

# Assumes:
#- repo is stored at ~/.dotfiles
#- Using an Arch-based distro
#- yay is installed

# Useful vars
SCRIPTS_DIR="$HOME/.dotfiles/dotfile-utils"
AUR_INSTALL_CMD='yay -S'
OHMYZSH_DIR="$HOME/.oh-my-zsh" # oh-my-zsh install dir

# Pre-install
echo "Pacman: Updating mirrors..."
sudo pacman -Syy

# Install
echo "Updating dotfiles..."
$SCRIPTS_DIR/restdots
echo "Installing packages..."
sudo pacman -S $(cat "$SCRIPTS_DIR/../pkgs/com-pkg-list")

#   Install yay
echo "Installing yay..."
sudo pacman -S base-devel
mkdir -p ~/.cache/dotfiles
git clone https://aur.archlinux.org/yay.git ~/.cache/dotfiles/yay
cd ~/.cache/dotfiles/yay
makepkg -sic
cd && rm -r ~/.cache/dotfiles
$AUR_INSTALL_CMD $(cat "$SCRIPTS_DIR/../pkgs/aur-pkg-list")

#   oh-my-zsh
echo "Installing oh-my-zsh..."
if [[ ! -e "$OHMYZSH_DIR" ]] ; then
  git clone https://github.com/ohmyzsh/ohmyzsh.git "$OHMYZSH_DIR"
else
  echo "oh-my-zsh directory already exists at $OHMYZSH_DIR. Aborting."
fi

#   Finish setup
echo "Finalizing setup..."
$SCRIPTS_DIR/extsetup

# Post-install
echo 'Done!'
